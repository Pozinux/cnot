<div>On active la capture en tâche de fond avec le &amp;</div><div>&nbsp;&nbsp;&nbsp;<br></div><div>On capture sur eth0 l'intégralité des paquets (1500 octets).</div><div>La capture est mémorisée dans le fichier /tmp/ssh.tcp</div><div>On ne s'intéresse qu'au trafic associé au ssh sur le port 22 (on pourrait s'intéresser au traffic associé au web sur le port 80 par exemple).</div><div>&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">[root@vps190794 tmp]# tcpdump -i eth0 -s 1500 -w /tmp/ssh.tcp port 22 &amp;</span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">[1] 26314</span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">[root@vps190794 tmp]# tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 1500 bytes</span></span></div></div><div>&nbsp;&nbsp;&nbsp;<br></div><div>Mettre fin à la capture :</div><div>&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>[root@vps190794 tmp]# pkill tcpdump</div><div>23 packets captured</div><div>23 packets received by filter</div><div>0 packets dropped by kernel</div><div>[1]+&nbsp; Done&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcpdump -i eth0 -s 1500 -w /tmp/ssh.tcp port 22</div></div><div>&nbsp;&nbsp;&nbsp;<br></div><div>Visualiser la capture :</div><div>&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>[root@centos2 tmp]# less /tmp/ssh.tcp</div><div><span style="color: rgb(255, 0, 0);">"/tmp/ssh.tcp" may be a binary file.&nbsp; See it anyway?</span></div><div>&nbsp;&nbsp;&nbsp;<br></div><div>[root@vps190794 tmp]# tcpdump -r ssh.tcp</div><div>reading from file ssh.tcp, link-type EN10MB (Ethernet)</div><div>21:53:40.495166 IP vps190794.ovh.net.ssh &gt; tie49-1-78-210-92-181.fbx.proxad.net.49423: Flags [P.], seq 3823882439:3823882479, ack 1037076679, win 236, length 40</div><div>21:53:40.502967 IP tie49-1-78-210-92-181.fbx.proxad.net.49423 &gt; vps190794.ovh.net.ssh: Flags [.], ack 0, win 16084, length 0</div><div>21:53:40.718772 IP tie49-1-78-210-92-181.fbx.proxad.net.49423 &gt; vps190794.ovh.net.ssh: Flags [.], ack 40, win 16074, length 0</div><div>21:53:41.437492 IP tie49-1-78-210-92-181.fbx.proxad.net.49423 &gt; vps190794.ovh.net.ssh: Flags [P.], seq 1:25, ack 40, win 16074, length 24</div><div>21:53:41.439152 IP vps190794.ovh.net.ssh &gt; tie49-1-78-210-92-181.fbx.proxad.net.49423: Flags [P.], seq 40:64, ack 25, win 236, length 24</div><div>21:53:41.670285 IP tie49-1-78-210-92-181.fbx.proxad.net.49423 &gt; vps190794.ovh.net.ssh: Flags [.], ack 64, win 16068, length 0</div><div>21:53:44.837569 IP tie49-1-78-210-92-181.fbx.proxad.net.49423 &gt; vps190794.ovh.net.ssh: Flags [P.], seq 25:49, ack 64, win 16068, length 24</div><div>21:53:44.839174 IP vps190794.ovh.net.ssh &gt; tie49-1-78-210-92-181.fbx.proxad.net.49423: Flags [P.], seq 64:104, ack 49, win 236, length 40</div><div>21:53:45.005534 IP tie49-1-78-210-92-181.fbx.proxad.net.49423 &gt; vps190794.ovh.net.ssh: Flags [P.], seq 49:73, ack 104, win 16058, length 24</div><div>21:53:45.007173 IP vps190794.ovh.net.ssh &gt; tie49-1-78-210-92-181.fbx.proxad.net.49423: Flags [P.], seq 104:144, ack 73, win 236, length 40</div><div>21:53:45.166046 IP tie49-1-78-210-92-181.fbx.proxad.net.49423 &gt; vps190794.ovh.net.ssh: Flags [P.], seq 73:97, ack 144, win 16048, length 24</div><div>21:53:45.168135 IP vps190794.ovh.net.ssh &gt; tie49-1-78-210-92-181.fbx.proxad.net.49423: Flags [P.], seq 144:168, ack 97, win 236, length 24</div><div>21:53:45.365677 IP tie49-1-78-210-92-181.fbx.proxad.net.49423 &gt; vps190794.ovh.net.ssh: Flags [P.], seq 97:121, ack 168, win 16042, length 24</div><div>21:53:45.367158 IP vps190794.ovh.net.ssh &gt; tie49-1-78-210-92-181.fbx.proxad.net.49423: Flags [P.], seq 168:192, ack 121, win 236, length 24</div></div><div>&nbsp;&nbsp;&nbsp;<br></div><div>Isoler toutes les connexions qui utilisent le port 21 (ftp - je me connecte avec le compte "anonymous" (câd pas de mdp) sur le serveur ftp de ma VM centos depuis mon filezilla windows) :</div><div>&nbsp;&nbsp;&nbsp;<br></div><div>J'arrive dans un "/" contenant un répertoire "pub" mais c'est un chroot depuis "/var/ftp/pub ".</div><div>&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>[root@centos2 tmp]# tcpdump -i eno16777736 port 21</div><div>tcpdump: verbose output suppressed, use -v or -vv for full protocol decode</div><div>listening on eno16777736, link-type EN10MB (Ethernet), capture size 262144 bytes</div><div>&nbsp;&nbsp;&nbsp;<br></div><div>21:41:32.982502 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [S], seq 2657930768, win 64240, options [mss 1460,nop,wscale 8,nop,nop,sackOK], length 0</div><div>21:41:32.982564 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [S.], seq 616944042, ack 2657930769, win 29200, options [mss 1460,nop,nop,sackOK,nop,wscale 7], length 0</div><div>21:41:32.982804 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [.], ack 1, win 2053, length 0</div><div>21:41:32.986385 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 1:21, ack 1, win 229, length 20: FTP: 220 (vsFTPd 3.0.2)</div><div>21:41:32.986666 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [P.], seq 1:11, ack 21, win 2053, length 10: FTP: AUTH TLS</div><div>21:41:32.986682 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [.], ack 11, win 229, length 0</div><div>21:41:32.986783 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 21:59, ack 11, win 229, length 38: FTP: 530 Please login with USER and PASS.</div><div>21:41:32.986949 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [P.], seq 11:21, ack 59, win 2052, length 10: FTP: AUTH SSL</div><div>21:41:32.986981 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 59:97, ack 21, win 229, length 38: FTP: 530 Please login with USER and PASS.</div><div>21:41:32.987205 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [P.], seq 21:37, ack 97, win 2052, length 16: FTP: USER <span style="background-color: rgb(255, 250, 165);">anonymous</span></div><div>21:41:32.987543 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 97:131, ack 37, win 229, length 34: FTP: 331 Please specify the password.</div><div>21:41:32.987741 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [P.], seq 37:65, ack 131, win 2052, length 28: FTP: PASS anonymous@example.com</div><div>21:41:32.988723 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 131:154, ack 65, win 229, length 23: FTP: 230 <span style="background-color: rgb(255, 250, 165);">Login successful</span>.</div><div>21:41:32.989004 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [P.], seq 65:71, ack 154, win 2052, length 6: FTP: SYST</div><div>21:41:32.989164 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 154:173, ack 71, win 229, length 19: FTP: 215 UNIX Type: L8</div><div>21:41:32.989391 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [P.], seq 71:77, ack 173, win 2052, length 6: FTP: FEAT</div><div>21:41:32.989551 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 173:188, ack 77, win 229, length 15: FTP: 211-Features:</div><div>21:41:32.989627 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 188:195, ack 77, win 229, length 7: FTP:&nbsp; EPRT</div><div>21:41:32.989713 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [.], ack 195, win 2052, length 0</div><div>21:41:32.989729 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 195:202, ack 77, win 229, length 7: FTP:&nbsp; EPSV</div><div>21:41:32.989789 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 202:209, ack 77, win 229, length 7: FTP:&nbsp; MDTM</div><div>21:41:32.989868 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [.], ack 209, win 2052, length 0</div><div>21:41:32.989894 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 209:216, ack 77, win 229, length 7: FTP:&nbsp; PASV</div><div>21:41:32.989956 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 216:230, ack 77, win 229, length 14: FTP:&nbsp; REST STREAM</div><div>21:41:32.990036 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [.], ack 230, win 2052, length 0</div><div>21:41:32.990051 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 230:237, ack 77, win 229, length 7: FTP:&nbsp; SIZE</div><div>21:41:32.990110 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 237:244, ack 77, win 229, length 7: FTP:&nbsp; TVFS</div><div>21:41:32.990190 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [.], ack 244, win 2052, length 0</div><div>21:41:32.990205 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 244:251, ack 77, win 229, length 7: FTP:&nbsp; UTF8</div><div>21:41:32.990266 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 251:260, ack 77, win 229, length 9: FTP: 211 End</div><div>21:41:32.990348 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [.], ack 260, win 2052, length 0</div><div>21:41:32.990602 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [P.], seq 77:91, ack 260, win 2052, length 14: FTP: OPTS UTF8 ON</div><div>21:41:32.990800 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 260:286, ack 91, win 229, length 26: FTP: 200 Always in UTF8 mode.</div><div>21:41:32.992587 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [P.], seq 91:96, ack 286, win 2052, length 5: FTP: PWD</div><div>21:41:32.992812 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 286:295, ack 96, win 229, length 9: FTP: 257 <span style="background-color: rgb(255, 250, 165);">"/"</span></div><div>21:41:32.993469 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [P.], seq 96:104, ack 295, win 2051, length 8: FTP: TYPE I</div><div>21:41:32.993702 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 295:326, ack 104, win 229, length 31: FTP: 200 Switching to Binary mode.</div><div>21:41:32.993899 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [P.], seq 104:110, ack 326, win 2051, length 6: FTP: PASV</div><div>21:41:32.994160 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 326:377, ack 110, win 229, length 51: FTP: 227 Entering Passive Mode (192,168,0,14,139,192).</div><div>21:41:32.994604 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [P.], seq 110:116, ack 377, win 2051, length 6: FTP: LIST</div><div>21:41:32.995218 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 377:416, ack 116, win 229, length 39: FTP: 150 Here comes the directory listing.</div><div>21:41:32.995563 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [P.], seq 416:440, ack 116, win 229, length 24: FTP: 226 Directory send OK.</div><div>21:41:32.995712 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [.], ack 440, win 2051, length 0</div></div><div>&nbsp;</div><div>Si je me log en FTP avec mon compte tim (user du serveur) :</div><div>&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>21:44:14.590824 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [F.], seq 116, ack 440, win 2051, length 0</div><div>21:44:14.591019 IP centos2.ftp &gt; 192.168.0.15.57058: Flags [F.], seq 440, ack 117, win 229, length 0</div><div>21:44:14.591158 IP 192.168.0.15.57058 &gt; centos2.ftp: Flags [.], ack 441, win 2051, length 0</div><div>21:44:14.597805 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [S], seq 2670131315, win 64240, options [mss 1460,nop,wscale 8,nop,nop,sackOK], length 0</div><div>21:44:14.597846 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [S.], seq 3909781314, ack 2670131316, win 29200, options [mss 1460,nop,nop,sackOK,nop,wscale 7], length 0</div><div>21:44:14.598026 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [.], ack 1, win 2053, length 0</div><div>21:44:14.599873 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 1:21, ack 1, win 229, length 20: FTP: 220 (vsFTPd 3.0.2)</div><div>21:44:14.600141 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [P.], seq 1:11, ack 21, win 2053, length 10: FTP: AUTH TLS</div><div>21:44:14.600156 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [.], ack 11, win 229, length 0</div><div>21:44:14.600466 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 21:59, ack 11, win 229, length 38: FTP: 530 Please login with USER and PASS.</div><div>21:44:14.600666 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [P.], seq 11:21, ack 59, win 2052, length 10: FTP: AUTH SSL</div><div>21:44:14.600830 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 59:97, ack 21, win 229, length 38: FTP: 530 Please login with USER and PASS.</div><div>21:44:14.601012 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [P.], seq 21:31, ack 97, win 2052, length 10: FTP: <span style="background-color: rgb(255, 250, 165);">USER tim</span></div><div>21:44:14.601176 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 97:131, ack 31, win 229, length 34: FTP: 331 Please specify the password.</div><div>21:44:14.601339 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [P.], seq 31:46, ack 131, win 2052, length 15: FTP: <span style="background-color: rgb(255, 250, 165);">PASS poiuytre</span></div><div>21:44:14.625344 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 131:154, ack 46, win 229, length 23: FTP: 230 Login successful.</div><div>21:44:14.625655 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [P.], seq 46:52, ack 154, win 2052, length 6: FTP: SYST</div><div>21:44:14.625722 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 154:173, ack 52, win 229, length 19: FTP: 215 UNIX Type: L8</div><div>21:44:14.625866 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [P.], seq 52:58, ack 173, win 2052, length 6: FTP: FEAT</div><div>21:44:14.626157 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 173:188, ack 58, win 229, length 15: FTP: 211-Features:</div><div>21:44:14.626264 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 188:195, ack 58, win 229, length 7: FTP:&nbsp; EPRT</div><div>21:44:14.626430 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [.], ack 195, win 2052, length 0</div><div>21:44:14.626474 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 195:202, ack 58, win 229, length 7: FTP:&nbsp; EPSV</div><div>21:44:14.626662 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 202:209, ack 58, win 229, length 7: FTP:&nbsp; MDTM</div><div>21:44:14.626784 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [.], ack 209, win 2052, length 0</div><div>21:44:14.626801 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 209:216, ack 58, win 229, length 7: FTP:&nbsp; PASV</div><div>21:44:14.626897 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 216:230, ack 58, win 229, length 14: FTP:&nbsp; REST STREAM</div><div>21:44:14.626996 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [.], ack 230, win 2052, length 0</div><div>21:44:14.627030 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 230:237, ack 58, win 229, length 7: FTP:&nbsp; SIZE</div><div>21:44:14.627089 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 237:244, ack 58, win 229, length 7: FTP:&nbsp; TVFS</div><div>21:44:14.627176 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [.], ack 244, win 2052, length 0</div><div>21:44:14.627191 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 244:251, ack 58, win 229, length 7: FTP:&nbsp; UTF8</div><div>21:44:14.627253 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 251:260, ack 58, win 229, length 9: FTP: 211 End</div><div>21:44:14.627323 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [.], ack 260, win 2052, length 0</div><div>21:44:14.627422 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [P.], seq 58:72, ack 260, win 2052, length 14: FTP: OPTS UTF8 ON</div><div>21:44:14.627728 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 260:286, ack 72, win 229, length 26: FTP: 200 Always in UTF8 mode.</div><div>21:44:14.629300 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [P.], seq 72:77, ack 286, win 2052, length 5: FTP: PWD</div><div>21:44:14.629565 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 286:303, ack 77, win 229, length 17: FTP: 257 "<span style="background-color: rgb(255, 250, 165);">/home/tim</span>"</div><div>21:44:14.629744 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [P.], seq 77:85, ack 303, win 2051, length 8: FTP: TYPE I</div><div>21:44:14.629806 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 303:334, ack 85, win 229, length 31: FTP: 200 Switching to Binary mode.</div><div>21:44:14.629957 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [P.], seq 85:91, ack 334, win 2051, length 6: FTP: PASV</div><div>21:44:14.630303 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 334:385, ack 91, win 229, length 51: FTP: 227 Entering Passive Mode (192,168,0,14,125,200).</div><div>21:44:14.630598 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [P.], seq 91:97, ack 385, win 2051, length 6: FTP: LIST</div><div>21:44:14.631229 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 385:424, ack 97, win 229, length 39: FTP: 150 Here comes the directory listing.</div><div>21:44:14.631854 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 424:448, ack 97, win 229, length 24: FTP: 226 Directory send OK.</div><div>21:44:14.631939 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [.], ack 448, win 2051, length 0</div><div>21:44:14.632142 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [P.], seq 97:109, ack 448, win 2051, length 12: FTP: MDTM test1</div><div>21:44:14.632353 IP centos2.ftp &gt; 192.168.0.15.57062: Flags [P.], seq 448:468, ack 109, win 229, length 20: FTP: 213 20170929204956</div><div>21:44:14.673980 IP 192.168.0.15.57062 &gt; centos2.ftp: Flags [.], ack 468, win 2051, length 0</div></div><div>&nbsp;&nbsp;&nbsp;<br></div><div>Capturer toutes les connexion qui ont pour source ou destination l'IP 192.168.1.2 sur l'interface eth1 :</div><div>&nbsp;<br></div><blockquote><font face="menlo">tcpdump -i eth1 net 192.168.1.2</font></blockquote><div>&nbsp;<br></div><div>Capturer toutes les connexions, qui ont pour source une adresse IP commençant par 192.168. :</div><div>&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">tcpdump -i eth0 src net 192.168</div><div>&nbsp;&nbsp;&nbsp;<br></div><div>Capturer toutes les connexions, qui ont pour destination une adresse IP bien précise :</div><div>&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">tcpdump -i eth0 dst net 192.168.0.175</div><div>&nbsp;&nbsp;&nbsp;<br></div><div>On pourra également isoler la source ou la destination. Ici on ne souhaite capturer que les envois de mails (port 25 en destination) :</div><div>&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">tcpdump -i eth0 dst port 25</div><div>&nbsp;&nbsp;&nbsp;<br></div><div>La commande tcpdump permet également d'utiliser des expressions logiques, afin d'affiner les captures. Pour cela, on peut utiliser les opérateurs logiques suivants :</div><div>&nbsp;&nbsp;&nbsp;<br></div><div>- Négation : ! ou not</div><div>- Opérateur et : &amp;&amp; ou and</div><div>- Opérateur ou : || ou or</div><div>&nbsp;&nbsp;&nbsp;<br></div><div>Si je souhaite capturer toutes les connexions réseaux qui vont de l'adresse IP 192.168.0.175 vers l'adresse 192.168.0.1, utilisant le protocole TCP et le port 80, je pourrais utiliser une expression comme celle-ci :</div><div>&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">tcpdump -i eth0 src 192.168.0.175 and dst 192.168.0.1 and port 80 and tcp</div><div>&nbsp;&nbsp;&nbsp;<br></div><div>Toutes les commandes dessus affichent le dialogue entre les cartes réseaux mais si on veut le contenu des packets il faut utiliser les options suivantes :</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote style="font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">-XX = ascii + hexa&nbsp;&nbsp;&nbsp;<br>-s0 = pour full content&nbsp;&nbsp;&nbsp;<br>[root@centos2 tmp]# tcpdump -XX -s0 -i eno16777736 port 21&nbsp;&nbsp;&nbsp;<br>tcpdump: verbose output suppressed, use -v or -vv for full protocol decode&nbsp;&nbsp;&nbsp;<br>listening on eno16777736, link-type EN10MB (Ethernet), capture size 262144 bytes&nbsp;&nbsp;&nbsp;<br>...&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; 0x0000:&nbsp; d0df 9afa f192 000c 297e ef23 0800 4500&nbsp; ........)~.#..E.&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; 0x0010:&nbsp; 004a a0b2 4000 4006 188e c0a8 000e c0a8&nbsp; .J..@.@.........&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; 0x0020:&nbsp; 000f 0015 df27 65bb b22e 704f 2837 5018&nbsp; .....'e...pO(7P.&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; 0x0030:&nbsp; 00e5 81aa 0000 3333 3120 506c 6561 7365&nbsp; ......331.Please&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; 0x0040:&nbsp; 2073 7065 6369 6679 2074 6865 2070 6173&nbsp; .specify.the.pas&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; 0x0050:&nbsp; 7377 6f72 642e 0d0a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sword...&nbsp;&nbsp;&nbsp;<br>22:03:30.348031 IP 192.168.0.15.57127 &gt; centos2.ftp: Flags [P.], seq 31:46, ack 131, win 2052, length 15: FTP: PASS&nbsp;<span style="background-color: rgb(255, 250, 165);">poiuytre&nbsp;&nbsp;&nbsp;<br></span>&nbsp; &nbsp; &nbsp; &nbsp; 0x0000:&nbsp; 000c 297e ef23 d0df 9afa f192 0800 4500&nbsp; ..)~.#........E.&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; 0x0010:&nbsp; 0037 3e15 4000 8006 3b3e c0a8 000f c0a8&nbsp; .7&gt;.@...;&gt;......&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; 0x0020:&nbsp; 000e df27 0015 704f 2837 65bb b250 5018&nbsp; ...'..pO(7e..PP.&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; 0x0030:&nbsp; 0804 0a15 0000 5041 5353 2070 6f69 7579&nbsp; ......<span style="background-color: rgb(255, 250, 165);">PASS.poiuy&nbsp;&nbsp;&nbsp;<br></span>&nbsp; &nbsp; &nbsp; &nbsp; 0x0040:&nbsp; 7472 650d 0a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="background-color: rgb(255, 250, 165);">tre..&nbsp;&nbsp;&nbsp;<br></span>22:03:30.368232 IP centos2.ftp &gt; 192.168.0.15.57127: Flags [P.], seq 131:154, ack 46, win 229, length 23: FTP: 230 Login successful.&nbsp;&nbsp;&nbsp;<br>...</blockquote><div>&nbsp;&nbsp;&nbsp;<br></div><div><div>&nbsp;&nbsp;&nbsp;<br><hr>&nbsp;&nbsp;&nbsp;<br></div><div>&nbsp;&nbsp;&nbsp;<br></div><div>To capture all the interfaces network traffic using tcpdump,just use “tcpdump”.</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo"># tcpdump</font></blockquote></div><div>&nbsp;&nbsp;&nbsp;<br></div><div><div>&nbsp;&nbsp;&nbsp;<br></div><div>To capture the network traffic on the particular interface,</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo"># tcpdump -i eth0</font></blockquote></div><div>&nbsp;&nbsp;&nbsp;<br></div><div><div>&nbsp;&nbsp;&nbsp;<br></div><div>To capture the “N” no of network packets , use “-c” option (To specify “N”&nbsp; value.)The below command captured just 10 packets from interface eth0.</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo"># tcpdump -c 10 -i eth0</font></blockquote></div><div>&nbsp;&nbsp;&nbsp;<br></div><div><div>&nbsp;&nbsp;&nbsp;<br></div><div>To display ASCII output of the network packets,use “-A” option.</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo"># tcpdump -A -i eth0</font></blockquote></div><div>&nbsp;&nbsp;&nbsp;<br></div><div><div>&nbsp;&nbsp;&nbsp;<br></div><div>To capture the packets in Hexadecimal and ASCII , use “-XX” option.</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo"># tcpdump -XX -i eth0</font></blockquote></div><div>&nbsp;&nbsp;&nbsp;<br></div><div><div>&nbsp;&nbsp;&nbsp;<br></div><div>To capture the network traffic between two IP address.</div><div>Source IP address: Local system IP</div><div>Destination IP address:Remote system IP</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo"># tcpdump src 192.168.10.14 and dst host 192.168.10.75 -c 10</font></blockquote></div><div>&nbsp;&nbsp;&nbsp;<br></div><div>&nbsp;&nbsp;&nbsp;<br></div><div><div>To capture the specific local port traffic using tcpdump,</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo"># tcpdump src port 22 -c 5</font></blockquote></div><div>&nbsp;&nbsp;&nbsp;<br></div><div>&nbsp;&nbsp;&nbsp;<br></div><div>To capture network traffic of destination port&nbsp;</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo"># tcpdump dst port 22 -c 5</font></blockquote><div>&nbsp;&nbsp;&nbsp;<br></div><div>&nbsp;&nbsp;&nbsp;<br></div><div><div>To filter the network traffic using destination IP address and local port number,</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo"># tcpdump dst 192.168.10.75 and src port 22 -c 5</font></blockquote></div><div>&nbsp;&nbsp;&nbsp;<br></div><div>&nbsp;&nbsp;&nbsp;<br></div><div><div>To filter the specific network traffic,use the below command.</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo"># tcpdump net 192.168.10.0/24 -c 5</font></blockquote></div><div>&nbsp;&nbsp;&nbsp;<br></div><div>&nbsp;&nbsp;&nbsp;<br></div><div><div>To filter the traffic using the protocal, Ex:ICMP</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo"># tcpdump icmp</font></blockquote></div><div>&nbsp;&nbsp;&nbsp;<br></div><div>&nbsp;&nbsp;&nbsp;<br></div><div><div>To filter the traffic using port range,</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo"># tcpdump portrange 20-24 -c 4</font></blockquote></div><div>&nbsp;&nbsp;&nbsp;<br></div><div>&nbsp;&nbsp;&nbsp;<br></div><div><div>To capture the network packets to the file, use “-w” option.File should have extension with the name “pcap”.</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo"># tcpdump portrange 20-24 -w saveme.pcap</font></blockquote></div><div>&nbsp;&nbsp;&nbsp;<br></div><div>&nbsp;&nbsp;&nbsp;<br></div><div><div>To read the captured file, use “-r” option.</div><div>&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo"># tcpdump -r saveme.pcap</font></blockquote></div><div>&nbsp;&nbsp;&nbsp;<br></div>