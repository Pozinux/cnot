<div><span style="font-weight: bold;">Connection refused</span> -&gt; port pas en écoute donc probablement service pas démarré à l'autre bout ou firewall local qui bloquerait ? (iptables, firewalld...). Ou le service écoute mais pas sur cette pate (par exemple SSH qui écoute sur la pate d'admin et pas de service).</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>Pour le SSH par exemple -&gt; This usually means these possibilities:</div><div>* openssh-server is not installed on the server</div><div>* The ssh service is down on the server.</div><div>* The ssh service is using a custom port instead of the default 22.</div><div>* openssh-server is not well configured (check /etc/ssh/sshd_config on the server).</div><div>* Port 22 is blocked by another software on the server side. Check you firewall or iptables.</div><div>&nbsp;&nbsp;<br></div><div>Pour un ESXi, les fois où ça m'est arrivé étaient que le service SSH de l'ESXi était désactivé. Il fallait se connecter en console pour le réactiver.</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><span style="font-weight: bold;">Standby ou Connection Timeout</span> -&gt; paquets dropés par le firewall (les flux ne sont pas ouverts) ou pbm de route.</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><span style="font-weight: bold;">No route to host</span> -&gt; Après qu'un serveur ait rebooté, j'ai eu cette erreur. Je pensais à une route dynamique qui aurait sauté au boot mais apparemment non car suite à un nouveau reboot j'ai retrouvé la connexion (le serveur ssh devait être dans les choux).&nbsp;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><hr></div><div><span style="color: rgb(255, 0, 0); font-weight: bold; text-decoration-line: underline;">&nbsp;<br></span></div><div><span style="color: rgb(255, 0, 0); font-weight: bold; text-decoration-line: underline;">Attention :</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>Tester si un port répond ne fonctionne normalement que si c'est du TCP. L'UDP ne répond pas puisqu'il ne marche pas avec une session. Il écoute, reçoit et traite mais ne renvoi rien.</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>Par exemple on ne peut pas tester (avec telnet par exemple) le port snmp (161) car c'est de l'UDP et telnet du TCP. Voir solution plus loin pour snmp.</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>Pour le port rsylsog par défaut c'est de l'UDP en 514. Si j'ai accès à la machine serveur et cliente je peux établir un flux avec nc pour tester que ça passe :</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>1- both on client and server install nc:&nbsp;yum install nc&nbsp;(for centos)</div><div>2- on server listen UDP port:&nbsp;nc -ul 6111</div><div>3- on client&nbsp;nc -u &lt;server&gt; 6111</div><div>4- type anything on client and hit enter - you should see this text on server</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>Note:&nbsp;When you run the&nbsp;nc -ul&nbsp;command on the server, it will&nbsp;only&nbsp;connect for the first connection coming to it. You can't, as I found out, switch between servers pinging it without stopping and restarting&nbsp;nc -ul. In fact, if you ^C stop the client (nc -u ...), you also cannot restart the client without first restarting the server listener.</div></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>mais si je n'ai pas accès au serveur mais seulement au client, je peux tester comme suivant mais le résultat n'est pas nécessairement ok.</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>Envoyer des packets UDP au serveur adresse_ip au port 514 et reporter lequel ne répond pas avec un packet ICMP après 3 secondes :</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><span style="font-weight: bold;">Note</span> : on peut tester un range de ports par exemple 514-517</div><div>Note : si on ne met pas le v, on aura pas d'erreur affichée si erreur</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div># nc -v -u -z -w 3 adresse_ip 514</div><div>Connection to XXXXXXXX 514 port [udp/syslog] succeeded !</div></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><a href="https://serverfault.com/questions/416205/testing-udp-port-connectivity">https://serverfault.com/questions/416205/testing-udp-port-connectivity</a></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><hr></div><div><span style="font-size: 16pt; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></span></div><div><span style="font-size: 16pt; font-weight: bold;">Techniques pour tester un port&nbsp;</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"># telnet serveur port</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>Quitter Telnet :</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>CTRL + $ puis quit</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>Pour le faire sur une boucle (et donc mettre un timeout ici 2 secondes avec déconnexion) :</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">for i in $(cat liste); do echo $i; echo quit | timeout --signal=9 2 telnet $i PORT_TESTE; done</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>ou bien avec opennssl (normalement installé car ssh) :</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"># openssl s_client -connect serveur:port</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>ou avec ssh :</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"># ssh -vp port serveur</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;"># exec 3&lt;&gt;/dev/tcp/serveur/port</span></span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><span style="font-size: 12px;"><span style="color: rgb(118, 0, 216); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-weight: bold;">si la connexion se fait (il rend le prompt sinon il part en timeout) :</span></span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><span style="font-size: 12px;"><span style="color: rgb(118, 0, 216); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-weight: bold;">Si on fait un netstat on voit la connexion establish :</span></span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;"># netstat -panut | grep server:port &nbsp; OU ss -taupen</span></span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.15);"><div>[root@XXXX~]# netstat -panut | grep "10.XX.XX.XX"</div><div>tcp 0 1 10.YY.YY.YY:55447 10.XX.XX.XX:22 FIN_WAIT1 -</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>[root@SERVER1 ~]# ss -taupen |grep :22</div><div>tcp FIN-WAIT-1 0 1 10.YY.YY.YY:55447 10.XX.XX.XX:22 timer:(on,11sec,8) ino:0 sk:ffff880c051fa740</div></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><span style="font-size: 12px;"><span style="color: rgb(118, 0, 216); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-weight: bold;">Après il faut fermer le socket qu'on a ouvert :</span></span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;"># exec 3&lt;&gt;&amp;-</span></span></div></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>Christophe utilise cette commande pour scripter le test des ports Waarp :</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">&lt;/dev/tcp/${Serveur_R66}/6667) 2&gt;/dev/null &amp;&amp; F_Echo ${Serveur_R66}, 6667, Ok || F_Echo ${Serveur_R66}, 6667, KO</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><span style="font-weight: bold;">SNMP</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>Pour tester l'ouverture du port 161 protocole SNMP par exemple :</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">snmpwalk -v2c -c COMMUNAUTE_SNMP serveur</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div>