<div>sed n'est pas un éditeur de texte, il travaille sur le flux de texte ligne par ligne. Donc à moins de le préciser, le fichier d'origine ne sera pas modifié.&nbsp;Pour ne pas avoir à enregistrer la modification dans un fichier temporaire et ensuite sur lui-même comme ci-dessus, utiliser sed -i qui modifiera la fichier original directement.</div><div>&nbsp;<br></div><div><span style="font-weight: bold;">Supprimer la dernière ligne du </span><b>fichier </b><span style="font-weight: bold;">/etc/group et écraser le fichier :</span></div><div>&nbsp;<br></div><div style="padding: 8px; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;"><div># sed '$d' /etc/group &gt; /etc/group.tmp &amp;&amp; mv -f /etc/group.tmp /etc/group</div><div>&nbsp;<br></div><div>ou bien&nbsp;</div><div>&nbsp;<br></div><div># sed -i '$d' /etc/group</div></div><div>&nbsp;<br></div><div>$ : match the last line</div><div>d : delete</div><div>&nbsp;<br></div><div>On peut aussi supprimer la troisième ligne :</div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"># sed -i '3d' /etc/group</div><div>&nbsp;<br></div><div>&nbsp;<br></div><div><span style="font-weight: bold;">Supprimer les lignes du fichier qui contiennent le PATTERN :</span></div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"># sed -i '/PATTERN/d' file</div><div>&nbsp;<br></div><div>&nbsp;<br></div><div><span style="font-weight: bold;">Remplacer une chaine de caractères :</span></div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">[root@centos6 ~]# sed -i 's/ONBOOT=yes/ONBOOT=no/g' /etc/sysconfig/network-scripts/ifcfg-eth0</div><div>&nbsp;<br></div><div>On peut aussi modifier plusieurs fichiers comme suivant :</div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">[root@centos6 ~]# sed -i 's/ONBOOT=yes/ONBOOT=no/g' /etc/sysconfig/network-scripts/ifcfg-eth0 /etc/sysconfig/network-scripts/ifcfg-eth1</div><div>&nbsp;<br></div><div>Si la chaine que l'on veut remplacer est variable mais qu'elle se trouve entre deux caractères distincts (ici %) :</div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">sed -i 's/<span style="background-color: rgb(255, 250, 165);">%.*.%</span>/<span style="background-color: rgb(255, 250, 165);">%newchaine%</span>/g fichier.txt</div><div>&nbsp;<br></div><div>Note : attention, s'il n'a rien entre %%, ça ne va pas fonctionner car il ne trouvera rien à remplacer.</div><div>Note : Faire un backup avec sed -i plutôt que de remplacer le fichier directement --&gt; "sed -i.ori" qui va faire un backup du fichier.</div><div>&nbsp;<br></div><div><span style="font-size: 16px; text-decoration-line: underline;">Expressions régulières :</span></div><div>&nbsp;<br></div><div>https://www.cnot.tpoz.fr/index.php?doss=Linux%20Traitement%20de%20texte</div><div>&nbsp;<br></div><div>J'ai trouvé que le plus simple était déjà de faire un egrep pour voir si sa regex est ok (car il colorize ce qui est trouvé) avant de la passer dans sed.</div><div>&nbsp;<br></div><div>Option -r de sed pour lui dire qu'on va mettre une expression régulière.</div><div>&nbsp;<br></div><div><span style="text-decoration-line: underline;">Exemple :</span></div><div>&nbsp;<br></div><div>Un fichier :</div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>45565 Tim</div><div>54555 Tom</div><div>12343 Toto</div></div><div>&nbsp;<br></div><div>Je veux en résultat :</div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>Tim ----&gt; 45565</div><div>Tom ----&gt;&nbsp;54555</div><div>Toto ----&gt; 12343</div></div><div>&nbsp;<br></div><div>Un exemple de commande (car on peut trouver d'autres expressions régulières qui marcheraient) :</div><div>&nbsp;<br></div><div>() permettent de récupérer la sous-chaine qui correspond. Le résultat du premier () porte l'identifiant 1 que l'on peut afficher en \1, le deuxième () s'affiche avec \2 etc.</div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>[root@centos2 ~]# sed -r 's/^([0-9]*) ([A-Z][a-z]*)/\2 ---&gt; \1/g' toto</div><div>Tim ---&gt; 45565</div><div>Tom ---&gt; 54555</div><div>Toto ---&gt; 12343</div><div>&nbsp;<br></div></div><div>&nbsp;<br></div><div>Exemple 2 : Extraire l'adresse web entre guillements des lignes suivantes et rajouter "adresse :" :</div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>[root@centos2 ~]# cat toto</div><div>&lt;li class="forme.kjkj"&gt;&lt;a href="http://forum.dkjjd.com/index.htm"&gt;20&lt;/a&gt;&lt;/li&gt;</div><div>&lt;li class="fqqsdfsdforme.kjkj"&gt;&lt;a class="" href="http://forum.dkjjiid.com/index.htm"&gt;20&lt;/a&gt;&lt;/li&gt;</div></div><div>&nbsp;<br></div><div>Note : J'ai remplacé les / de sed (qui définissent la source et la destination de la substitution par des # pour mieux lire la commande (Lire plus bas quels délimiteurs on peut utiliser). J'aurais pu garder les / mais dans ce cas il m'aurait fallu échapper les / de http:// avec des \ pour pas qu'il les considères comme des délimiteurs :</div><div>&nbsp;<br></div><div>p : print</div><div>&nbsp;<br></div><div>A noter que ce qui est en rouge n'est finalement pas nécessaire</div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>[root@centos2 ~]# sed -r 's#.*"(http://.+\..+.com/index.htm)<span style="color: rgb(227, 0, 0);">".</span>*#Adresse : \1#p' toto</div><div>Adresse : http://forum.dkjjd.com/index.htm</div><div>Adresse : http://forum.dkjjiid.com/index.htm</div></div><div>&nbsp;<br></div><div><hr></div><div><span style="font-weight: bold;">DELIMITEURS</span></div><div>&nbsp;<br></div><div>When using sed's substitute command, this is the most common syntax:</div><div>&nbsp;<br></div><div>echo foo | sed s/foo/bar/</div><div>&nbsp;<br></div><div>Here sed is used to replace the text foo with bar before it is echoed. The delimiter of choice is a forward slash (/), which is the most commonly used delimiter. However, sed can use any character as a delimiter. In fact, it will automatically use the character following the&nbsp;s&nbsp;as a delimiter.</div><div>&nbsp;<br></div><div>For example, this works:</div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>echo&nbsp;foo&nbsp;|&nbsp;sed&nbsp;s,foo,bar,</div><div>&nbsp;<br></div><div>echo&nbsp;foo&nbsp;|&nbsp;sed&nbsp;'s&nbsp;foo&nbsp;bar&nbsp;'</div></div><div>&nbsp;<br></div><div><hr></div><div><span style="font-weight: bold;">Utiliser sed pour substituer / autre synthaxe&nbsp;</span></div><div>&nbsp;<br></div><div>Je souhaite changer le disable = yes en disable = no</div><div>&nbsp;<br></div><div>Je fais ça :</div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>[root@centos2 xinetd.d]# sed -r 's/disable.+= yes/disable&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =</div><div>no/g' /etc/xinetd.d/tftp</div><div>&nbsp;<br></div><div>service tftp</div><div>{</div><div>&nbsp; &nbsp; ...</div><div>&nbsp; &nbsp; server_args&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = -s /var/lib/tftpboot</div><div>&nbsp; &nbsp; disable&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = no</div><div>&nbsp; &nbsp; per_source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = 11</div><div>&nbsp; &nbsp; ...</div><div>}</div></div><div>&nbsp;<br></div><div>mais on peut aussi faire :</div><div>&nbsp;<br></div><div>The spaces are more commonly known as "whitespace", and can include not just spaces but tabs (and other "blank" characters). In a regular expression you can often refer to these either with&nbsp;[[:space:]]&nbsp;or&nbsp;\s&nbsp;(depending on the RE engine).</div><div>&nbsp;<br></div><div>You cannot replace with&nbsp;grep&nbsp;- it's just a searching tool. Instead, to replace the&nbsp;yes&nbsp;with&nbsp;no&nbsp;you can use a command like this:</div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">sed '/disable\&gt;/s/\&lt;yes\&gt;/no/' /etc/xinetd.d/tftp</div><div>&nbsp;<br></div><div>This tells&nbsp;sed&nbsp;to substitute (change) the word&nbsp;yes&nbsp;into&nbsp;no&nbsp;on any line that contains the word&nbsp;disable. (The&nbsp;\&gt;&nbsp;forces an end-of-word.) Conveniently this sidesteps the issue of whitespace altogether.</div><div>&nbsp;<br></div><div>Be careful: with a line such as&nbsp;eyes yes, an unbounded&nbsp;yes&nbsp;substitution would apply to the first instance of&nbsp;yes&nbsp;and leave you with&nbsp;eno yes. That's why I have used&nbsp;\&lt;yes\&gt;&nbsp;instead of just&nbsp;yes.</div><div>&nbsp;<br></div><div>Mais plus simplement (sachant qu'il n'y a pas de "eyes yes" ou d'autres "disable" dans mon fichier, je peux tout simplement faire :</div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">sed '/disable/s/no/yes/' /etc/xinetd.d/tftp</div><div>&nbsp;<br></div><div>Il va remplacer no par yes aux lignes du fichiers qui contiennent disable.</div><div>&nbsp;<br></div><div>&nbsp;<br></div><div><span style="font-weight: bold;">Supprimer les multiples espaces par un seul</span></div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">cat fic1 | sed -r 's/\s+/ /g'</div><div>&nbsp;<br></div><div>et pour modifier le fichier d'origine :</div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">sed -i -r 's/\s+/ /g' fic1</div><div>&nbsp;<br></div><div>&nbsp;<br></div><div><span style="font-weight: bold;">Commenter une ligne commençant pas "</span><span style="font-weight: bold;">deb cdrom"</span><span style="font-weight: bold;">&nbsp;dans le fichier</span> <span style="font-weight: bold;">/etc/apt/</span><span style="font-weight: bold;">sources.list:</span></div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">sed -i "s/^\(deb cdrom.*\)/# \1/g" /etc/apt/sources.list</div><div>&nbsp;<br></div><div>&nbsp;<br></div><div><span style="font-weight: bold;">Supprimer les caractères spécifiques pour les couleurs :</span></div><div>&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">cat file | sed 's/\x1B\[[0-9;]\+[A-Za-z]//g'</div><div>&nbsp;<br></div><div>&nbsp;<br></div><div>&nbsp;<br></div>