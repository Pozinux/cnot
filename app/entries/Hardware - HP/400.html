<div>Un <span style="font-weight: bold;">ESXi 6.0</span> custom HP installé sur un HP (Proliant DL 380 G9 dans mon cas) a des commandes ESXCLI en plus pour les contrôleur stockage/disque :</div><div>&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>~ # esxcli hpssacli cmd -q "controller all show status"</div><div>&nbsp;&nbsp;<br></div><div>Smart Array P420i in Slot 0 (Embedded)</div><div>&nbsp; &nbsp;Controller Status: OK</div><div>&nbsp; &nbsp;Cache Status: Permanently Disabled</div><div>&nbsp; &nbsp;Battery/Capacitor Status: Failed (Replace Batteries/Capacitors)</div><div>&nbsp;&nbsp;<br></div><div>~ # esxcli hpssacli cmd -q "controller all show config"</div><div>&nbsp;&nbsp;<br></div><div>Smart Array P420i in Slot 0 (Embedded) (sn: XXXXXXX)</div><div>&nbsp;&nbsp;<br></div><div>&nbsp; &nbsp; &nbsp;Port Name : 1I</div><div>&nbsp; &nbsp; &nbsp;Port Name</div><div>....</div><div>&nbsp;&nbsp;<br></div><div>~ # esxcli hpssacli cmd -q "controller slot=0 &nbsp;show config detail"</div><div>&nbsp;&nbsp;<br></div><div>Smart Array P420i in Slot 0 (Embedded)</div><div>&nbsp; &nbsp;Bus Interface: PCI</div><div>&nbsp; &nbsp;Slot: 0</div><div>&nbsp; &nbsp;Serial Number: 50014380279BA0B0</div><div>&nbsp; &nbsp;Cache Serial Number: PBKUA0BRH4W6SB</div><div>&nbsp; &nbsp;RAID 6 (ADG) Status: Disabled</div><div>&nbsp; &nbsp;Controller Status: OK</div><div>&nbsp; &nbsp;Hardware Revision: B</div><div>&nbsp; &nbsp;Firmware Version: 3.54</div><div>&nbsp; &nbsp;Rebuild Priority: Medium</div><div>&nbsp; &nbsp;Expand Priority: Medium</div><div>...</div></div><div>&nbsp;</div><div>ça fonctionne aussi en faisant par exemple :</div><div>&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>esxcli hpssacli cmd -q "ctrl all show config"</div><div>&nbsp;&nbsp;<br></div><div>ou même :</div><div>&nbsp;&nbsp;<br></div><div>/opt/hp/hpssacli/bin/hpssacli ctrl all show config</div></div><div>&nbsp;&nbsp;<br></div><div><span style="font-size: 16px;"><span style="font-weight: bold;">Testé aussi en 5.0 :</span></span></div><div>&nbsp;&nbsp;<br></div><div>Par exemple là sur un DL Gen8 avec un "Cached modules status failed", on peut récupérer plus sur l'erreur (car ça peut être un pbm lié au cache module lui-même ou bien à la batterie de la carte contrôleur) et aussi les références des pièces s'il faut commander.</div><div>&nbsp;&nbsp;<br></div><div>Pour se connecter déjà :</div><div>&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div># /opt/hp/hpacucli/bin/hpac:ucli</div><div>=&gt;</div></div><div>&nbsp;&nbsp;<br></div><div>puis les commandes :</div><div>&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>=&gt; ctrl all show status</div><div>&nbsp;&nbsp;<br></div><div>Smart Array P220i in Slot 0 (Embedded)</div><div>&nbsp; &nbsp;Controller Status: OK</div><div>&nbsp; &nbsp;Cache Status: Permanently Disabled</div><div>&nbsp; &nbsp;Battery/Capacitor Status: Failed (Replace Batteries/Capacitors)</div><div>&nbsp;&nbsp;<br></div><div>=&gt; ctrl all show detail</div><div>&nbsp;&nbsp;<br></div><div>Smart Array P220i in Slot 0 (Embedded)</div><div>&nbsp; &nbsp;Bus Interface: PCI</div><div>&nbsp; &nbsp;Slot: 0</div><div>&nbsp; &nbsp;<span style="background-color: rgb(255, 250, 165);">Serial Number: PCQVU0CRH5A1S0</span></div><div>&nbsp; &nbsp;<span style="background-color: rgb(255, 250, 165);">Cache Serial Number: PBKHV</span></div><div>&nbsp; &nbsp;RAID 6 (ADG) Status: Enabled</div><div>&nbsp; &nbsp;Controller Status: OK</div><div>&nbsp; &nbsp;Hardware Revision: B</div><div>&nbsp; &nbsp;Firmware Version: 4.68</div><div>&nbsp; &nbsp;Rebuild Priority: Medium</div><div>&nbsp; &nbsp;Expand Priority: Medium</div><div>&nbsp; &nbsp;Surface Scan Delay: 15 secs</div><div>&nbsp; &nbsp;Surface Scan Mode: Idle</div><div>&nbsp; &nbsp;Queue Depth: Automatic</div><div>&nbsp; &nbsp;Monitor and Performance Delay: 60 &nbsp;min</div><div>&nbsp; &nbsp;Elevator Sort: Enabled</div><div>&nbsp; &nbsp;Degraded Performance Optimization: Disabled</div><div>&nbsp; &nbsp;Inconsistency Repair Policy: Disabled</div><div>&nbsp; &nbsp;Wait for Cache Room: Disabled</div><div>&nbsp; &nbsp;Surface Analysis Inconsistency Notification: Disabled</div><div>&nbsp; &nbsp;Post Prompt Timeout: 0 secs</div><div>&nbsp; &nbsp;Cache Board Present: True</div><div>&nbsp; &nbsp;<span style="background-color: rgb(255, 250, 165);">Cache Status: Permanently Disabled</span></div><div><span style="background-color: rgb(255, 250, 165);">&nbsp; &nbsp;Cache Status Details: Cache disabled; capacitor failed to charge to an acceptable level</span></div><div>&nbsp; &nbsp;Cache Ratio: 25% Read / 75% Write</div><div>&nbsp; &nbsp;Drive Write Cache: Disabled</div><div>&nbsp; &nbsp;Total Cache Size: 512 MB</div><div>&nbsp; &nbsp;Total Cache Memory Available: 304 MB</div><div>&nbsp; &nbsp;No-Battery Write Cache: Disabled</div><div>&nbsp; &nbsp;Cache Backup Power Source: Capacitors</div><div>&nbsp; &nbsp;Battery/Capacitor Count: 1</div><div>&nbsp; &nbsp;<span style="background-color: rgb(255, 250, 165);">Battery/Capacitor Status: Failed (Replace Batteries)</span></div><div>&nbsp; &nbsp;SATA NCQ Supported: True</div><div>&nbsp; &nbsp;Spare Activation Mode: Activate on drive failure</div><div>&nbsp; &nbsp;Controller Temperature (C): 50</div><div>&nbsp; &nbsp;Cache Module Temperature (C): 0</div><div>&nbsp; &nbsp;Capacitor Temperature &nbsp;(C): 17</div></div><div>&nbsp;&nbsp;<br></div><div>Pour générer un rapport ADU qui donne toutes les infos pour le support :</div><div>&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div># esxcli hpacucli cmd -q "controller slot=0 show config detail"</div><div>&nbsp;&nbsp;<br></div><div>OU BIEN</div><div>&nbsp;&nbsp;<br></div><div># /opt/hp/hpacucli/bin/hpacucli</div><div>=&gt;&nbsp;controller slot=0 show config detail</div><div>...</div></div><div>&nbsp;&nbsp;<br></div><div><hr></div><div>&nbsp;&nbsp;<br></div><div><span style="font-size: 16px;"><span style="font-weight: bold;">Apparemment à tester en 5.5 et 6.5 :</span></span></div><div>&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>Show configuration</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl all show config</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl all show config</div><div>&nbsp;&nbsp;<br></div><div>Controller status</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl all show status</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl all show status</div><div>&nbsp;&nbsp;<br></div><div>Show detailed controller information for all controllers</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl all show detail</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl all show detail</div><div>&nbsp;&nbsp;<br></div><div>Show detailed controller information for controller in slot 0</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 show detail</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 show detail</div><div>&nbsp;&nbsp;<br></div><div>Rescan for New Devices</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli rescan</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli rescan</div><div>&nbsp;&nbsp;<br></div><div>Physical disk status</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 pd all show status</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 pd all show status</div><div>&nbsp;&nbsp;<br></div><div>Show detailed physical disk information</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 pd all show detail</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 pd all show detail</div><div>&nbsp;&nbsp;<br></div><div>Logical&nbsp;disk status</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 ld all show status</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 ld all show status</div><div>&nbsp;&nbsp;<br></div><div>View Detailed Logical Drive Status</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 ld 2 show</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 ld 2 show</div><div>&nbsp;&nbsp;<br></div><div>Create New RAID 0 Logical Drive</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 create type=ld drives=1I:1:2 raid=0</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 create type=ld drives=1I:1:2 raid=0</div><div>&nbsp;&nbsp;<br></div><div>Create New RAID 1 Logical Drive</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 create type=ld drives=1I:1:1,1I:1:2 raid=1</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 create type=ld drives=1I:1:1,1I:1:2 raid=1</div><div>&nbsp;&nbsp;<br></div><div>Create New RAID 5 Logical Drive</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 create type=ld drives=1I:1:1,1I:1:2,2I:1:6,2I:1:7,2I:1:8 raid=5</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 create type=ld drives=1I:1:1,1I:1:2,2I:1:6,2I:1:7,2I:1:8 raid=5</div><div>&nbsp;&nbsp;<br></div><div>Delete Logical Drive</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 ld 2 delete</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 ld 2 delete</div><div>&nbsp;&nbsp;<br></div><div>Add New Physical Drive to Logical Volume</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 ld 2 add drives=2I:1:6,2I:1:7</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 ld 2 add drives=2I:1:6,2I:1:7</div><div>&nbsp;&nbsp;<br></div><div>Add Spare Disks</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 array all add spares=2I:1:6,2I:1:7</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 array all add spares=2I:1:6,2I:1:7</div><div>&nbsp;&nbsp;<br></div><div>Enable Drive Write Cache</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 modify dwc=enable</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 modify dwc=enable</div><div>&nbsp;&nbsp;<br></div><div>Disable Drive Write Cache</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 modify dwc=disable</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 modify dwc=disable</div><div>&nbsp;&nbsp;<br></div><div>Erase Physical Drive</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 pd 2I:1:6 modify erase</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 pd 2I:1:6 modify erase</div><div>&nbsp;&nbsp;<br></div><div>Turn on Blink Physical Disk LED</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 ld 2 modify led=on</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 ld 2 modify led=on</div><div>&nbsp;&nbsp;<br></div><div>Turn off Blink Physical Disk LED</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 ld 2 modify led=off</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 ld 2 modify led=off</div><div>&nbsp;&nbsp;<br></div><div>Modify smart array cache read and write ratio (cacheratio=readratio/writeratio)</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 modify cacheratio=100/0</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 modify cacheratio=100/0</div><div>&nbsp;&nbsp;<br></div><div>Enable smart array write cache when no battery is present (No-Battery Write Cache option)</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 modify nbwc=enable</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 modify nbwc=enable</div><div>&nbsp;&nbsp;<br></div><div>Disable smart array cache for certain&nbsp;Logical Volume</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 logicaldrive 1 modify arrayaccelerator=disable</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 logicaldrive 1 modify arrayaccelerator=disable</div><div>&nbsp;&nbsp;<br></div><div>Enable&nbsp;smart array cache for certain&nbsp;Logical Volume</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 logicaldrive 1 modify arrayaccelerator=enable</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 logicaldrive 1 modify arrayaccelerator=enable</div><div>&nbsp;&nbsp;<br></div><div>Enable SSD Smart Path</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 array a modify ssdsmartpath=enable</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 array a modify ssdsmartpath=enable</div><div>&nbsp;&nbsp;<br></div><div>Disable&nbsp;SSD Smart Path</div><div>ESXi 5.5 -&gt;&nbsp;/opt/hp/hpssacli/bin/hpssacli ctrl slot=0 array a modify ssdsmartpath=disable</div><div>ESXi 6.5 -&gt;&nbsp;/opt/smartstorageadmin/ssacli/bin/ssacli ctrl slot=0 array a modify ssdsmartpath=disable</div></div><div>&nbsp;&nbsp;<br></div><div>&nbsp;&nbsp;<br></div>