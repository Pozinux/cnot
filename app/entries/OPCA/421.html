<div>Lors du lancement de la commande (voir même du démarrage de la BDD), le serveur a un load important + wa important mais pourtant ne semble pas avoir de saturation CPU ou mémoire.</div><div>Changement de la VM sur un autre datastore, pas de changement.</div><div>&nbsp;&nbsp;<br></div><div>En console, les messages d'erreurs suivant apparaissent :</div><div>&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><font style="color: rgb(255, 0, 0);">Message from syslogd@server1 at Apr 8 08:09:48 ... kernel:watchdog: BUG: soft lockup - CPU#8 stuck for 22s!</font></div><div>&nbsp;&nbsp;<br></div><div>Le problème a été résolu en passant la VM de 34 à 16 CPU.</div><div>&nbsp;&nbsp;<br></div><div><span style="text-decoration-line: underline;">EXPLICATIONS :</span></div><div>&nbsp;&nbsp;<br></div><div>Le problème venait bien d'une saturation des ressources CPU de l'hôte (Voir Doc ID Oracle 2213119.1).</div><div>&nbsp;&nbsp;<br></div><div>Voici mon analyse dans notre cas :</div><div>&nbsp;&nbsp;<br></div><div>La VM de 34 vCPU se trouve sur un compute node X6 qui a 88 vCPU (2 coeurs physiques x 20 coeurs x 2 thread) de disponibles.</div><div>&nbsp;&nbsp;<br></div><div>Sur ce compute node se trouve deux autres VM. Une de 44 vCPU + une de 8 vCPU et le compute node se réserve à lui seul 20 vCPU :</div><div>&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>[root@ovcacn31r1 ~]# xm list</div><div>Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ID&nbsp;&nbsp;&nbsp;Mem VCPUs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;State&nbsp;&nbsp;&nbsp;Time(s)</div><div>0004fb00000600002f3758d84c9e475f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 307203&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: rgb(255, 250, 165);">44</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r----- 13378203.2</div><div>0004fb00000600004d3547da5d0b9d42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6 65539&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: rgb(255, 250, 165);">16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-b----&nbsp;&nbsp;90356.7</div><div>0004fb00000600006d254d90c432396f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3 65539&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: rgb(255, 250, 165);">8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r----- 698428.2</div><div><span style="background-color: rgb(255, 250, 165);">Domain-0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 11236&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: rgb(255, 250, 165);">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r----- 1742361.6</div></div><div>&nbsp;&nbsp;<br></div><div>Donc :</div><div>&nbsp;&nbsp;<br></div><div>44 + 34 + 8 + 20 = <span style="color: rgb(255, 0, 0);">106 vCPU nécessaires sur 88 disponibles.</span></div><div>&nbsp;&nbsp;<br></div><div>Passage de la VM à 16 vCPU.</div><div>&nbsp;&nbsp;<br></div><div>Donc :</div><div><font color="#000000">&nbsp;&nbsp;<br></font></div><div><font color="#000000">44 + 16 + 8 +20 = 88 vCPU nécessaires sur 88 disponibles.</font></div><div>&nbsp;&nbsp;<br></div><div>Bon ça n'empêche que l'on reste limite quand même...</div><div>&nbsp;&nbsp;<br></div><div><span style="text-decoration-line: underline;">Tout dépend donc :</span></div><div>&nbsp;&nbsp;<br></div><div>- sur quel compute node (X6 de 88 vCPU ou X5 de 72 vCPU) la VM se trouve</div><div>- avec quelles autres VM sur le même compute node et combien de vCPU leur sont affectées</div><div>&nbsp;&nbsp;<br></div><div>Il faudra le prendre en compte lors de demande de création de nouvelles VM ou d'ajout de CPU sur les VM existantes.</div><div>Un capacity planning doit permettre de s'affranchir de ces problèmes.</div>