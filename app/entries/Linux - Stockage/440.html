<div>On rajoute un disque sur la VM pour en faire une partition puis un PV.</div><div>&nbsp;&nbsp;<br></div><div>Ce disque sera rattaché à un host scsi (hba). host0 est la hba numéro 0.</div><div>Il faut le rescanner (voir plus bas) pour qu'il voit le nouveau disque à moins qu'il soit déjà reconnu à chaud.</div><div>&nbsp;&nbsp;<br></div><div>Vérifier s'il est reconnu à chaud :</div><div>&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div># lsblk</div><div># fdisk -l</div></div><div>&nbsp;&nbsp;<br></div><div>Pour déterminer à quel host est rattaché le disque, lister les périphériques scsi :</div><div>&nbsp;&nbsp;<br></div><div>note : Host = carte hba</div><div>&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>[root@centos2 ~]# cat /proc/scsi/scsi</div><div>Attached devices:</div><div><span style="background-color: rgb(255, 250, 165);">Host: scsi<span style="color: rgb(255, 0, 0);"><b>0</b></span></span> Channel: 00 Id: 00 Lun: 00</div><div>&nbsp; Vendor: VMware,&nbsp; Model: VMware Virtual S Rev: 1.0</div><div>&nbsp; Type:&nbsp; &nbsp;Direct-Access&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ANSI&nbsp; SCSI revision: 02</div><div>Host: scsi0 Channel: 00 Id: 01 Lun: 00</div><div>&nbsp; Vendor: VMware,&nbsp; Model: VMware Virtual S Rev: 1.0</div><div>&nbsp; Type:&nbsp; &nbsp;Direct-Access&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ANSI&nbsp; SCSI revision: 02</div><div>Host: scsi0 Channel: 00 Id: 02 Lun: 00</div><div>&nbsp; Vendor: VMware,&nbsp; Model: VMware Virtual S Rev: 1.0</div><div>&nbsp; Type:&nbsp; &nbsp;Direct-Access&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ANSI&nbsp; SCSI revision: 02</div><div><span style="background-color: rgb(255, 250, 165);">Host: scsi<span style="color: rgb(255, 0, 0);"><b>2</b></span></span> Channel: 00 Id: 00 Lun: 00</div><div>&nbsp; Vendor: NECVMWar Model: VMware IDE CDR10 Rev: 1.00</div><div>&nbsp; Type:&nbsp; &nbsp;<span style="background-color: rgb(255, 250, 165);">CD-ROM</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ANSI&nbsp; SCSI revision: 05</div></div><div>&nbsp;&nbsp;<br></div><div>On peut voir donc qu'il y a deux hosts, un pour les disques et un pour le cdrom. Il faut donc rescanner celui des disques :</div><div>&nbsp;&nbsp;<br></div><div>Si le disque n'est pas reconnu à chaud sur l'OS, on rescanne le bus SCSI :</div><div>&nbsp;</div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"># echo "- - -" &gt; /sys/class/scsi_host/<span style="color: rgb(255, 0, 0);"><b>host0</b></span>/scan</div><div>&nbsp;&nbsp;<br></div><div><span style="font-weight: bold;">Note</span> : On peut le faire sur tous les host (il devrait accepter "host?" wildcard). Il ne supprime pas les LUN supprimés. Il ajoute seulement.</div><div>&nbsp;&nbsp;<br></div><div>Note : Si le disque n'apparait toujours pas, c'est peut-être qu'un disque avant lui a été supprimé à chaud pas de la bonne manière ( <a href="https://www.evernote.com/shard/s72/nl/8374248/7f7b52e8-d5a2-4863-9038-d8e34d28b210" style="color: rgb(105, 170, 53);">Supprimer un disque à chaud</a>&nbsp;)&nbsp;et que l'info existe toujours. Dans ce cas, rescanner le device (et non le host) avec son nom (par exemple sdb) :</div><div>&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);">[root@centos2 ~]# echo 1 &gt; /sys/block/<span style="background-color: rgb(255, 250, 165);">sdb</span>/device/rescan</div><div>&nbsp;&nbsp;<br></div><div>On voit maintenant le nouveau disque apparaitre :</div><div>&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div># lsblk</div><div># fdisk -l</div></div><div>&nbsp;&nbsp;<br></div><div>et voir dans les logs :</div><div>&nbsp;&nbsp;<br></div><div style="padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div>[root@centos2 ~]# tail /var/log/messages</div><div>Jun 17 22:09:41 centos2 kernel: scsi target0:0:3: Ending Domain Validation</div><div>Jun 17 22:09:41 centos2 kernel: scsi target0:0:3: FAST-40 WIDE SCSI 80.0 MB/s ST (25 ns, offset 127)</div><div>Jun 17 22:09:41 centos2 kernel: sd 0:0:3:0: [sdd] 6291456 512-byte logical blocks: (3.22 GB/3.00 GiB)</div><div>Jun 17 22:09:41 centos2 kernel: sd 0:0:3:0: [sdd] Write Protect is off</div><div>Jun 17 22:09:41 centos2 kernel: sd 0:0:3:0: [sdd] Cache data unavailable</div><div>Jun 17 22:09:41 centos2 kernel: sd 0:0:3:0: [sdd] Assuming drive cache: write through</div><div>Jun 17 22:09:41 centos2 kernel: sd 0:0:3:0: <span style="background-color: rgb(255, 250, 165);">[sdd] Attached SCSI disk</span></div><div>Jun 17 22:09:41 centos2 kernel: sd 0:0:3:0: Attached scsi generic sg4 type 0</div></div><div>&nbsp;&nbsp;<br></div>