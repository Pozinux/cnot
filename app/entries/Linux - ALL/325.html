<font size="3">Synchoniser la destination avec la source.&nbsp;</font><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>Cela signifie que si un fichier est modifié dans la destination il sera remis comme la source.<div>Aussi <b>--delete</b> va supprimer à la destination les fichiers qui n'existent pas à la source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><div>Utiliser d'abord -n pour dry-run (pas de modif juste lister) :</div><div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><blockquote><font face="menlo">#&nbsp;rsync -avnc --delete --exclude entries --exclude credentials.php cnot/app<span style="background-color: rgb(255, 255, 0);">/</span>&nbsp;cnotdemo/app&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>sending incremental file list&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><font color="#ff0000">deleting&nbsp;</font>coucou&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>./&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>credentials.php&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>css/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>js/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>js/jquery.popline.js&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>js/plugins/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>js/plugins/jquery.popline.link.js&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>themes/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>themes/default.css&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>sent 1,830 bytes&nbsp; received 59 bytes&nbsp; 3,778.00 bytes/sec&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>total size is 3,190,499&nbsp; speedup is 1,688.99 (<font color="#000000" style="background-color: rgb(255, 255, 0);">DRY RUN</font>)</font></blockquote></div></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div></div><div><div><hr></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><a href="https://unix.stackexchange.com/questions/341413/see-only-changes-when-running-rsync/341415#:~:text=There%20is%20%2Di%20option%20for,target%20directory%20from%20source%20directory.">https://unix.stackexchange.com/questions/341413/see-only-changes-when-running-rsync/341415#:~:text=There%20is%20%2Di%20option%20for,target%20directory%20from%20source%20directory.</a></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div><a href="http://andreafrancia.blogspot.com/2010/03/as-you-may-know-rsyncs-delete-options.html">http://andreafrancia.blogspot.com/2010/03/as-you-may-know-rsyncs-delete-options.html</a></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>As you may know the rsync's --delete options if misused could make severe damage.</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>To prevent this you can use the <b>--itemize-change</b> and the <b>--dry-run</b> options to figure out how the command will behave before launching the real one.</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>The output will be something like that:</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><blockquote><font face="menlo">.d..t..g... ./&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>.f...p.g... Something.pdf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>.f.....g... md5sum-2010-02-21.txt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>.f...p.g... prova.rb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>.d.....g... .metadata/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>.f...p.g... .metadata/.lock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>.f...p.g... .metadata/.log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>.f...p.g... .metadata/version.ini&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&gt;f+++++++++ Parameter_Usage.txt</font></blockquote><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></div><div>Where the first field of each line tell what rsync would do to each file.</div><div>I wrote this little schema that helped me to understand this output format and I'm publishing hoping it will be useful for others.</div><div><div>&nbsp; &nbsp; &nbsp;&nbsp;<br></div><blockquote><font face="menlo">YXcstpoguax&nbsp; path/to/file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>|||||||||||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>`----------- the type of update being done::&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;||||||||||&nbsp; &nbsp;&lt;: file is being transferred to the remote host (sent).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;||||||||||&nbsp; &nbsp;&gt;: file is being transferred to the local host (received).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;||||||||||&nbsp; &nbsp;c: local change/creation for the item, such as:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;||||||||||&nbsp; &nbsp; &nbsp; - the creation of a directory&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;||||||||||&nbsp; &nbsp; &nbsp; - the changing of a symlink,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;||||||||||&nbsp; &nbsp; &nbsp; - etc.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;||||||||||&nbsp; &nbsp;h: the item is a hard link to another item (requires --hard-links).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;||||||||||&nbsp; &nbsp;.: the item is not being updated (though it might have attributes that are being modified).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;||||||||||&nbsp; &nbsp;*: means that the rest of the itemized-output area contains a message (e.g. "deleting").&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;||||||||||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;`---------- the file type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; |||||||||&nbsp; &nbsp;f for a file,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; |||||||||&nbsp; &nbsp;d for a directory,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; |||||||||&nbsp; &nbsp;L for a symlink,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; |||||||||&nbsp; &nbsp;D for a device,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; |||||||||&nbsp; &nbsp;S for a special file (e.g. named sockets and fifos).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; |||||||||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; `--------- c: different checksum (for regular files)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp;||||||||&nbsp; &nbsp; &nbsp;changed value (for symlink, device, and special file)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp;`-------- s: Size is different&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; `------- t: Modification time is different&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; &nbsp;`------ p: Permission are different&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; &nbsp; `----- o: Owner is different&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp;`---- g: Group is different&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; `--- u: The u slot is reserved for future use.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;`-- a: The ACL information changed</font></blockquote></div><div><br></div><div><br></div><div><div><font size="4">Copier un gros fichier avec l’option sparse</font></div><div><br></div><div>Typiquement la copie d'une image disque, comme l’image disque d’une distribution. Pour l’exemple, je vais prendre une image disque d’une Debian 7 non compressée. Cette image fait 10Go.&nbsp;</div><div>Mais si je fais un rsync sans indiquer d’option spécifique, il va me copier les 10Go à travers le réseau. Alors qu’en fait, l’image ne fait que 952Mo sur le disque.&nbsp;</div><div>Je peux vérifier la taille réelle avec la fonction ls -s.</div><div>Dans ce cas je peux utiliser l’option --sparse qui va copier uniquement les données réellement sur le disque.&nbsp;</div><div>Et l’option --progress est une barre de progression de la copie, utile quand il y a un gros fichier à copier. A la fin de la copie, sur le serveur de backup avec un ls, je peux bien constater qu’il n’a copié que les données utiles (952Mo).</div></div></div></div></div>